
---

## Системные колонки

`ctid`
Физическое расположение данной версии строки в таблице. Заметьте, что хотя по `ctid` можно очень быстро найти версию строки, значение `ctid` изменится при выполнении `VACUUM FULL`. Таким образом, `ctid` нельзя применять в качестве долгосрочного идентификатора строки. Для идентификации логических строк следует использовать первичный ключ

```sql
select ctid from operation
```

результат:
```
| ctid |  
| :--- |  
| \(0,1\) |  
| \(0,2\) |  
...
| \(0,32\) |  
| \(0,33\) |  
| \(1,1\) |  
| \(1,2\) |  
...
```

----
## bytea VS LOB (large object)/oid
#bytea #blob #oid

#### 1. Основные характеристики

**`bytea`:**

- Последовательность байтов, которая работает аналогично другим значениям типа TOAST (сжатие больших значений).
- Ограничение до **1 ГБ** на одно значение и до **32 ТБ** на таблицу.

**`LOB` (large object):**

- Бинарные данные, разбитые на несколько строк.
- Поддерживает операции поиска, чтения и записи, как файл операционной системы, что позволяет выполнять операции без загрузки всего содержимого в память сразу.
- Ограничено до **4 ТБ** на одно значение и до **32 ТБ** на базу данных.
#### 2. Преимущества и недостатки каждого типа

**Преимущества `bytea`:**

- Простота использования: большинство клиентских библиотек предоставляют удобные функции для декодирования данных.
- Меньше ограничений по управлению данными: каждый объект хранится непосредственно в таблице, а не в отдельной структуре, как у `LOB`.
- Автоматическое удаление при удалении «владельца» записи.

**Недостатки `bytea`:**

- Ограничения по размеру: максимальный размер одного значения ограничен 1 ГБ.
- Невозможность обработки больших объемов данных частями (streaming), так как весь массив данных загружается целиком.

**Преимущества `LOB`:**

- Возможность работы с большими объемами данных через потоковую обработку (streaming).
- Более гибкое управление памятью за счет того, что данные могут обрабатываться частями.
- Больший лимит на размер одного значения – до 4 ТБ.

**Недостатки `LOB`:**

- Сложнее управлять правами доступа к данным, поскольку они хранятся в одной общей таблице.
- Необходимо вручную удалять объекты после удаления записей, которым они принадлежат.
- Требует дополнительного управления и контроля за состоянием объектов.
- Возможны проблемы с поддержкой некоторых операций со стороны клиентских драйверов.

#### 3. Когда использовать каждый тип?

**Когда использовать `bytea`:**

- Если данные имеют относительно небольшой размер (до 1 ГБ).
- Если вам нужна простота и удобство использования, а также автоматическая обработка удаления данных.
- Если нет необходимости в потоковой обработке данных.

**Когда использовать `LOB`:**

- Для хранения очень больших файлов (более 1 ГБ).
- При необходимости частичной обработки данных (например, для передачи данных частями).
- В случаях, когда требуется гибкость в управлении файлами и их содержимым.

P.S.
- CLOB – _Character Large Object_ will store large text data
- [BLOB](https://www.baeldung.com/cs/blob-storage) – _Binary Large Object_ is for storing binary data like image, audio, or video

В intellij IDEA можно сделать выборку и скачать файл
-  ДЛЯ BLOB:

```sql
select file_oid from report_async where id = 1046;  
select lo_get(77225094)
```

- Для получения bytea файла хватит обычной выборки поля c bytea-типом

---
