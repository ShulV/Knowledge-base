## Получить свой публичный ключ
#public #key #ssh
```bash
# дефолт
cat ~/.ssh/id_rsa.pub
# более современный и короткий
cat ~/.ssh/id_ed25519.pub
```
P.S. положить в ~/.ssh/authorized_keys на удаленном сервере к тому пользователю, к которому нужно будет подключаться

---
## Типы SSH-ключей
#terminal #command #ssh #network #rsa #ed25519 #security

**теория:**
**RSA, Ed25519 и ECDSA** - это различные алгоритмы шифрования, используемые для генерации SSH-ключей. Вот их основные отличия

- RSA - широко используемый и хорошо поддерживаемый алгоритм с хорошей производительностью.
- Ed25519 - современный и безопасный выбор с лучшей производительностью на современных устройствах (короткий ключ)
- ECDSA - использует более короткие ключи, хорошо подходит для ресурсоёмких сред и мобильных устройств.

---

## Подключение по SSH
#ssh #connect
```bash
ssh shulpov.v@50.249.14.205
```
shulpov.v - пользователь на тесте
50.249.14.205 - адрес сервера
порт по умолчанию - 22 (можно с флгом `-p` указать)


---

## Туннелирование запроса
#tunnel #proxy #ssh 

1) Проброс трафика на определенный порт на удаленном сервере
```bash
ssh -L 8085:localhost:443 admin@51.250.15.205
```

где:
51.250.15.205 - адрес сервера
443 - порт на удаленном сервере
8085 - локальный порт
флаг «‑L» - указывает на то, что нам необходимо открыть туннель и начать слушать порт

2) Проброс трафика на определенный адрес и порт на удаленном сервере
```bash
ssh -L 5432:postgres-db:5432:remote.server.address
```
где:
remote.server.address - адрес сервера
postgres-db - адрес postgres сервера
5432 (второй) - порт на удаленном сервере
5432 (первый) - локальный порт
флаг «‑L» - указывает на то, что нам необходимо открыть туннель и начать слушать порт




P.S. выжимка из более хардкорных мест
```
**-L** _порт:машина:порт_машины_

Определяет заданный порт на локальной (клиентской) машине который будет перенаправлен к заданной машине и порт на удаленной машине. Это реализовано путём назначения доменного подключения "прослушиваемому" _порту_ на стороне локальной машины и всякий раз, когда производится соединение на этот порт, оно будет перенаправлено через защищенный канал и произведено соединение к _порту_ _порт_машины_ удаленной машины. Перенаправление портов моет быть так же указано в файле конфигурации. Только суперпользователь может осуществлять перенаправление привилегированных портов. Адреса IPv6 могут быть указаны с альтернативным синтаксисом: _port/host/hostport_.
```

---

## Обратный туннель
#tunnel #reverse #proxy 
```bash
ssh -R 0.0.0.0:3001:127.0.0.1:3000 server.ru
```
где:
0.0.0.0:3001 - адрес и порт общего сервера
127.0.0.1:3000 - локальный адрес и порт
server.ru - адрес SSH сервера
флаг «‑R» - флаг открытия обратного туннеля

P.S.

---
## Proxy jump
#tunnel #jump #proxy 

прыжок через 1 сервер:
```bash
ssh -J <jump server> <remote server>
```
много серверов:
```bash
ssh -J <jump server1>,<jump server2>,<jump server3> <remote server>
```

---
## Настройка ssh-config
#ssh #config 
```bash
# PROJECT_1 - xmap
Host xmap_dev_jump
    User v.shulpov
    Hostname dev-xmap
    Port 25022

Host xmap_stage_app1
    User v.shulpov
    Hostname 198.12.21.20
    ProxyJump xmap_dev_jump

Host xmap_stage_app2
    User v.shulpov
    Hostname 198.12.21.21
    ProxyJump xmap_dev_jump

Host xmap_stage_db
    User v.shulpov
    Hostname 198.12.21.24
    ProxyJump xmap_dev_jumpp

# PROJECT_2

Host project2
    User admin
    Hostname 50.250.15.205
```

можно подключаться так:
```bash
# project 1 (через jump-сервер)
> ssh xmap_stage_app1
# project 2
ssh project2
```
---
## Настройка таймаута ssh-сессии
#timeout #session #closed #time #interval #ping  #ssh
```bash
/etc/ssh/sshd_config
```

```
ClientAliveInterval 60
ClientAliveCountMax 5
```
ClientAliveInterval 60 — сервер каждые 60 секунд проверяет, жив ли клиент.
ClientAliveCountMax 5 — если клиент не отвечает 5 раз, то рвёт соединение.

